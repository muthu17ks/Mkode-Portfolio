{% extends 'base.html' %}

{% block title %}{{ project.title }} | Project Details{% endblock %}

{% block navbar %}
  {% include 'navbar.html' %}
{% endblock %}

{% block content %}

  <article class="project-page">
    <div class="container">

      {# --- Header --- #}
      <header class="project-header">
        <div class="project-back-wrapper">
          <a href="{{ back_url }}" class="link-archive icon-link">
            <i data-lucide="arrow-left"></i> <span>{{ back_text }}</span>
          </a>
        </div>
        <h1 class="project-title-main">{{ project.title }}</h1>
        <div class="project-meta-date">
          <i data-lucide="calendar"></i> Last Updated: {{ project.last_updated }}
        </div>
      </header>

      <div class="project-layout-grid">

        {# --- LEFT COLUMN: Content --- #}
        <div class="layout-content">

          {# A. CAROUSEL #}
          {% set carousel_section = project.sections | selectattr('type', 'equalto', 'carousel') | first %}
          {% if carousel_section %}
          <div id="{{ carousel_section.id }}" class="project-carousel reveal-up scroll-spy-target">
            <div class="carousel-track-container">
              <ul class="carousel-track">
                {% if project.images %}
                  {% for img in project.images %}
                  <li class="carousel-slide {% if loop.first %}current-slide{% endif %}">
                    <img src="{{ img }}" alt="{{ project.title }} - {{ carousel_section.title }}">
                  </li>
                  {% endfor %}
                {% else %}
                  <li class="carousel-slide current-slide">
                    <div class="carousel-placeholder">No Preview Available</div>
                  </li>
                {% endif %}
              </ul>
            </div>
            {% if project.images and project.images|length > 1 %}
            <button class="carousel-btn btn--left" data-cursor-ignore><i data-lucide="chevron-left"></i></button>
            <button class="carousel-btn btn--right" data-cursor-ignore><i data-lucide="chevron-right"></i></button>
            <div class="carousel-nav">
              {% for img in project.images %}
              <button class="carousel-indicator {% if loop.first %}current-slide{% endif %}" data-cursor-ignore></button>
              {% endfor %}
            </div>
            {% endif %}
          </div>
          {% endif %}

          {# B. META GRID #}
          <div class="project-meta-grid reveal-up">
            <div class="meta-card">
              <h4 class="meta-label">Technologies</h4>
              <div class="tech-stack-row">
                {% for t in project.tags %}
                <span class="tech-tag">{{ t }}</span>
                {% endfor %}
              </div>
            </div>
            <div class="meta-card actions-card">
              <h4 class="meta-label">Project Links</h4>
              <div class="meta-actions">
                {% if project.live_url %}
                <a href="{{ project.live_url }}" target="_blank" class="btn-main full-width-btn">
                  <i data-lucide="external-link"></i> Visit Live Website
                </a>
                {% endif %}
                {% if project.code_url %}
                <a href="{{ project.code_url }}" target="_blank" class="btn-secondary full-width-btn">
                  <i data-lucide="github"></i> View Source Code
                </a>
                {% endif %}
              </div>
            </div>
          </div>

          {# C. TEXT SECTIONS #}
          <div class="content-body">
            {% if project.sections %}
              {% for section in project.sections %}
                {% if section.type != 'carousel' %}

                  {# --- GROUP (Parent + Subsections) --- #}
                  {% if section.type == 'group' %}
                    {# 1. Main Heading for the Group #}
                    <div id="{{ section.id }}" class="group-header scroll-spy-target reveal-up">
                      <h2>{{ section.title }}</h2>
                    </div>
                    {# 2. Subsections #}
                    {% for sub in section.subsections %}
                      <section id="{{ sub.id }}" class="text-block scroll-spy-target reveal-up">
                        <h3>{{ sub.title }}</h3>
                        <p>{{ sub.content }}</p>
                      </section>
                    {% endfor %}

                  {# --- TEXT --- #}
                  {% elif section.type == 'text' %}
                    <section id="{{ section.id }}" class="text-block scroll-spy-target reveal-up">
                      <h3>{{ section.title }}</h3>
                      <p>{{ section.content }}</p>
                    </section>

                  {# --- LIST --- #}
                  {% elif section.type == 'list' %}
                    <section id="{{ section.id }}" class="text-block scroll-spy-target reveal-up">
                      <h3>{{ section.title }}</h3>
                      <ul class="feature-list-simple">
                        {% for item in section.content_items %}
                        <li><i data-lucide="check"></i> {{ item }}</li>
                        {% endfor %}
                      </ul>
                    </section>

                  {# --- GRID --- #}
                  {% elif section.type == 'grid' %}
                    <section id="{{ section.id }}" class="text-block scroll-spy-target reveal-up">
                      <h3>{{ section.title }}</h3>
                      <div class="challenges-grid">
                        {% for item in section.content_items %}
                        <div class="challenge-card">
                          <h4>{{ item.title }}</h4>
                          <p>{{ item.desc }}</p>
                        </div>
                        {% endfor %}
                      </div>
                    </section>

                  {% endif %}
                {% endif %}
              {% endfor %}
            {% endif %}
          </div>
        </div>

        {# --- RIGHT COLUMN: Sidebar (Sticky & Rail) --- #}
        <aside class="layout-sidebar">
          <div class="sticky-wrapper">
            <div class="sidebar-module">
              <h4 class="sidebar-label">On this page</h4>
              <nav class="toc-nav">
                <svg class="toc-rail-svg" width="40" height="100%">
                  <path class="rail-track" />
                  <path class="rail-fill" />
                </svg>

                <div class="toc-links-wrapper">
                  {% if project.sections %}
                    {% for section in project.sections %}
                      {% if section.type == 'group' %}
                        {# Parent #}
                        <a href="#{{ section.id }}" class="toc-link is-parent" data-cursor-ignore>{{ section.title }}</a>
                        {# Children #}
                        {% for sub in section.subsections %}
                          <a href="#{{ sub.id }}" class="toc-link is-child" data-cursor-ignore>{{ sub.title }}</a>
                        {% endfor %}
                      {% else %}
                        {# Standard #}
                        <a href="#{{ section.id }}" class="toc-link is-parent" data-cursor-ignore>{{ section.title }}</a>
                      {% endif %}
                    {% endfor %}
                  {% endif %}
                </div>
              </nav>
            </div>
          </div>
        </aside>

      </div>
                {# Navigation #}
          <nav class="project-navigation reveal-up">
            {% if prev_project %}
            <a href="{{ url_for('portfolio.project_detail', project_id=prev_project.id) }}" class="nav-card prev">
              <div class="nav-icon"><i data-lucide="arrow-left"></i></div>
              <div class="nav-info">
                <span class="nav-label">Previous Project</span>
                <span class="nav-title">{{ prev_project.title }}</span>
              </div>
            </a>
            {% else %}<div class="nav-spacer"></div>{% endif %}
            {% if next_project %}
            <a href="{{ url_for('portfolio.project_detail', project_id=next_project.id) }}" class="nav-card next">
              <div class="nav-info">
                <span class="nav-label">Next Project</span>
                <span class="nav-title">{{ next_project.title }}</span>
              </div>
              <div class="nav-icon"><i data-lucide="arrow-right"></i></div>
            </a>
            {% endif %}
          </nav>

    </div>
  </article>

{% endblock %}