{% extends 'base.html' %}

{% block title %}All Projects â€” Muthukumaran{% endblock %}

{% block navbar %}
  {% include 'navbar.html' %}
{% endblock %}

{% block content %}

  {#
     Reusing 'projects-section' class to get the background color
     and 'section-wrapper' for standard spacing.
     Added inline padding-top to clear the fixed navbar.
  #}
  <section class="section-wrapper projects-section" style="padding-top: calc(var(--nav-height) + 40px); min-height: 100vh;">
    <div class="container">

      {# Header using the same design as index #}
      <div class="section-header">
        <h1 class="section-title">All Projects</h1>
        <p class="section-subtitle">
          Every application, experiment, and build I've developed so far.
        </p>
      </div>

      <div class="projects-stack">
        {% for p in projects %}
          {# Define variables with safe defaults to prevent errors #}
          {% set pid = (p.id | default('proj-' ~ loop.index)) %}
          {% set title = p.title | default('Untitled Project') %}
          {% set desc = p.desc | default('Project description coming soon.') %}
          {% set image = p.image or url_for('portfolio.static', filename='assets/images/project-placeholder-card.png') %}
          {% set live = p.live_url %}
          {% set code = p.code_url %}
          {% set tags = p.tags | default([]) %}
          {% set highlights = p.highlights | default([]) %}
          {% set tagline = p.tagline %}

          <article class="project-card" id="project-{{ pid | replace(' ', '-') | lower }}">

            {# Left Column: Media #}
            <div class="project-card__media">
              <a href="{{ live or code or '#' }}"
                 target="{{ (live or code) and '_blank' or '_self' }}"
                 class="media-inner"
                 rel="noopener"
                 data-cursor-ignore> {% if tagline %}
                <div class="media-hook">
                  <span>{{ tagline }}</span>
                  <i data-lucide="arrow-up-right" class="hook-arrow" aria-hidden="true"></i>
                </div>
                {% endif %}

                <div class="media-image-container">
                  <img src="{{ image }}"
                       alt="{{ title }} Preview"
                       loading="lazy"
                       decoding="async">
                </div>
              </a>
            </div>

            {# Right Column: Content #}
            <div class="project-card__content">
              <h3 class="project-title">{{ title }}</h3>
              <p class="project-desc">{{ desc }}</p>

              {% if highlights %}
              <ul class="project-highlights" aria-label="Highlights for {{ title }}">
                {% for item in highlights %}
                <li>
                  <i data-lucide="check-circle-2" class="bullet-icon"></i>
                  {{ item }}
                </li>
                {% endfor %}
              </ul>
              {% endif %}

              <div class="project-tags">
                {% for t in tags %}
                <span class="tech-badge">{{ t }}</span>
                {% endfor %}
              </div>

              <div class="project-actions">
                {% if live %}
                <a href="{{ live }}" target="_blank" rel="noopener" class="btn-main" aria-label="Live Demo">
                  <i data-lucide="external-link" aria-hidden="true"></i>
                  <span>Live Demo</span>
                </a>
                {% endif %}

                {% if code %}
                <a href="{{ code }}" target="_blank" rel="noopener noreferrer" class="btn-main" aria-label="Source Code">
                  <i data-lucide="github" aria-hidden="true"></i>
                  <span>Code</span>
                </a>
                {% endif %}
              </div>
            </div>

          </article>
        {% endfor %}
      </div>

      <div class="section-footer">
        <a href="{{ url_for('portfolio.home') }}" class="link-archive">
          &larr; Back to Home
        </a>
      </div>

    </div>
  </section>

{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    // Ensure icons render if this page is loaded directly via AJAX or standard load
    if (typeof lucide !== 'undefined' && lucide.createIcons) {
      lucide.createIcons();
    }
  </script>
{% endblock %}